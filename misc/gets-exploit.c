#include <stdio.h>

/* Test is it possible to read shellcode to the
 * array from user input and transfer program control
 * there.
 *
 * It is not a real example because I rewrite return
 * address on my own. And in real example it should do
 * gets. But, I do not yet know how to get address
 * of the buffer in the real world example. */

/* just compile this file and dump-exploit.c
 * then do
 * $ ./dump-exploit | ./gets-exploit
 */

void foo(int arg) {
	unsigned char shellcode[53];
	unsigned long *sp = (unsigned long*)&arg;
	sp--;
	*sp = (unsigned long)shellcode;

	gets(shellcode);
}

int main(void) {
	foo(42);
	printf("Leaving main... This shouldn't be printed.\n");
	return 0;
}
